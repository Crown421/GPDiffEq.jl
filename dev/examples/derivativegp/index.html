<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Derivative of a GP · GPDiffEq.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GPDiffEq.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../theory/">Theory</a></li><li><a class="tocitem" href="../../symmetries/">Symmetries</a></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../solverapi/">Solver API</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Derivative of a GP</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#The-toy-model"><span>The toy model</span></a></li><li><a class="tocitem" href="#Derivative-of-a-GP-2"><span>Derivative of a GP</span></a></li></ul></li><li><a class="tocitem" href="../gpode/">Trajectory Uncertainty</a></li><li><a class="tocitem" href="../spiral/">Spiral ODE</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Derivative of a GP</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Derivative of a GP</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Crown421/GPDiffEq.jl/blob/main/examples/derivativegp/script.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Derivative-of-a-GP"><a class="docs-heading-anchor" href="#Derivative-of-a-GP">Derivative of a GP</a><a id="Derivative-of-a-GP-1"></a><a class="docs-heading-anchor-permalink" href="#Derivative-of-a-GP" title="Permalink"></a></h1><p><a href="https://nbviewer.jupyter.org/github/Crown421/GPDiffEq.jl/blob/gh-pages/dev/examples/derivativegp.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p><em>You are seeing the HTML output generated by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a> from the <a href="https://github.com/Crown421/GPDiffEq.jl/blob/main/examples/derivativegp/script.jl">Julia source file</a>. The corresponding notebook can be viewed in <a href="https://nbviewer.jupyter.org/github/Crown421/GPDiffEq.jl/blob/gh-pages/dev/examples/derivativegp.ipynb">nbviewer</a>.</em></p><p>The derivative of a GP is also a GP, as differentiation is a linear operators. In this example, we show how to use of the <code>DerivativeGP</code> and how to easily generate it from a known GP.</p><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><pre><code class="language-julia hljs">using GPDiffEq
using Plots</code></pre><h2 id="The-toy-model"><a class="docs-heading-anchor" href="#The-toy-model">The toy model</a><a id="The-toy-model-1"></a><a class="docs-heading-anchor-permalink" href="#The-toy-model" title="Permalink"></a></h2><p>We generate data for our model</p><pre><code class="language-julia hljs">σ_n = 3e-2
x = collect(range(-3, 3; length=10))
y = sin.(x) + σ_n * randn(length(x))</code></pre><pre><code class="nohighlight hljs">10-element Vector{Float64}:
 -0.13794892890990554
 -0.6854582832475714
 -1.0061274929761141
 -0.8698642733853623
 -0.35425941243021264
  0.34653271853345896
  0.8291483508130271
  1.0458078532049033
  0.6924381440180076
  0.14654808350799742</code></pre><p>which looks as follows</p><pre><code class="language-julia hljs">x_plot = collect(range(-3, 3; length=50))

plot(x_plot, sin.(x_plot); label=&quot;true&quot;, linewidth=2.5)
scatter!(x, y; label=&quot;data&quot;, markersize=5)

# Define a GP</code></pre><p><img src="../derivativegp-8.svg" alt/></p><p>We&#39;ll use a simple GP with a <code>ZeroMean</code> and <code>GaussianKernel</code>, condition it on our data</p><pre><code class="language-julia hljs">kernel = GaussianKernel()
f = GP(kernel)
fx = f(x, σ_n^2)

f_post = posterior(fx, y)</code></pre><pre><code class="nohighlight hljs">AbstractGPs.PosteriorGP{AbstractGPs.GP{AbstractGPs.ZeroMean{Float64}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, NamedTuple{(:α, :C, :x, :δ), Tuple{Vector{Float64}, LinearAlgebra.Cholesky{Float64, Matrix{Float64}}, Vector{Float64}, Vector{Float64}}}}(AbstractGPs.GP{AbstractGPs.ZeroMean{Float64}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}(AbstractGPs.ZeroMean{Float64}(), Squared Exponential Kernel (metric = Distances.Euclidean(0.0))), (α = [0.37819284925514607, 0.5311020801878809, -3.60863267159038, 5.579803225726668, -8.767769163660187, 10.398633541711558, -9.658672759336008, 8.115734064535015, -3.59242369738981, 0.7282104080886844], C = LinearAlgebra.Cholesky{Float64, Matrix{Float64}}([1.0004498987955368 0.8003773141272065 0.4109274147582345 0.13527442343644172 0.028552654979465738 0.0038641816488032754 0.0003353117715403665 1.8656075767503327e-5 6.655367228157499e-7 1.5223130876467006e-8; 0.8007374029168073 0.6002467451228027 0.7860774360298166 0.5045287013510821 0.18739357913541801 0.042437043869301076 0.005993442252878988 0.0005339982776949294 3.0207225222272073e-5 1.0889719997540142e-6; 0.4111122905071873 0.800737402916808 0.4627320221952479 0.7532454836302187 0.5447501912681774 0.21694755843305388 0.05125299553180774 0.0074308448185643515 0.0006730546137433022 3.8471936975043666e-5; 0.1353352832366127 0.4111122905071873 0.800737402916808 0.4008401941766902 0.7284671118734966 0.5632271754070077 0.23365913510519642 0.05662183999427727 0.008341514642992735 0.0007632276968352209; 0.028565500784550377 0.13533528323661262 0.41111229050718734 0.8007374029168081 0.3708790752043206 0.7123614154783097 0.5712010291281239 0.242503787177178 0.059633063470279454 0.008867504227890321; 0.0038659201394728076 0.028565500784550366 0.1353352832366127 0.41111229050718745 0.8007374029168081 0.3568392984503521 0.7029993719303738 0.5740291337269634 0.24663628796656215 0.06112098575317586; 0.00033546262790251185 0.003865920139472804 0.028565500784550366 0.1353352832366127 0.41111229050718745 0.8007374029168081 0.3509441161144569 0.6982952225737459 0.5746810106111326 0.24824985985472933; 1.866446911352057e-5 0.00033546262790251185 0.003865920139472804 0.028565500784550366 0.1353352832366127 0.41111229050718734 0.800737402916808 0.3488620260888474 0.6963366393076491 0.5746726576516153; 6.658361469857302e-7 1.8664469113520537e-5 0.00033546262790251185 0.003865920139472804 0.028565500784550366 0.13533528323661262 0.4111122905071873 0.800737402916808 0.3482835414112316 0.6956902200185071; 1.522997974471263e-8 6.658361469857302e-7 1.866446911352057e-5 0.00033546262790251185 0.0038659201394728076 0.028565500784550377 0.1353352832366127 0.4111122905071873 0.8007374029168073 0.3481716098016506], &#39;U&#39;, 0), x = [-3.0, -2.3333333333333335, -1.6666666666666667, -1.0, -0.3333333333333333, 0.3333333333333333, 1.0, 1.6666666666666667, 2.3333333333333335, 3.0], δ = [-0.13794892890990554, -0.6854582832475714, -1.0061274929761141, -0.8698642733853623, -0.35425941243021264, 0.34653271853345896, 0.8291483508130271, 1.0458078532049033, 0.6924381440180076, 0.14654808350799742]))</code></pre><p>and plot the posterior. Note that this GP completely untrained, no hyperparameters have been defined.</p><pre><code class="language-julia hljs">plot(x_plot, sin.(x_plot); label=&quot;true&quot;, linewidth=2.5)
scatter!(x, y; label=&quot;data&quot;, markersize=5)
plot!(
    x_plot,
    mean(f_post, x_plot);
    ribbons=sqrt.(var(f_post, x_plot)),
    label=&quot;GP&quot;,
    linewidth=2.5,
)</code></pre><p><img src="../derivativegp-12.svg" alt/></p><h2 id="Derivative-of-a-GP-2"><a class="docs-heading-anchor" href="#Derivative-of-a-GP-2">Derivative of a GP</a><a class="docs-heading-anchor-permalink" href="#Derivative-of-a-GP-2" title="Permalink"></a></h2><p>Now we can very easily generate the derivate of this GP</p><pre><code class="language-julia hljs">df_post = differentiate(f_post)</code></pre><pre><code class="nohighlight hljs">AbstractGPs.PosteriorGP{GPDiffEq.DerivativeGP{AbstractGPs.GP{AbstractGPs.ZeroMean{Float64}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, AbstractGPs.ZeroMean{Float64}, GPDiffEq.DerivativeKernelCollection{KernelFunctions.SqExponentialKernel{Distances.Euclidean}, GPDiffEq.FirstComponentDerivativeKernel{GPDiffEq.var&quot;#d10#12&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, GPDiffEq.SecondComponentDerivativeKernel{GPDiffEq.var&quot;#d01#15&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, GPDiffEq.BothComponentDerivativeKernel{GPDiffEq.var&quot;#d11#18&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}}}, NamedTuple{(:α, :C, :x, :δ), Tuple{Vector{Float64}, LinearAlgebra.Cholesky{Float64, Matrix{Float64}}, Vector{Float64}, Vector{Float64}}}}(GPDiffEq.DerivativeGP{AbstractGPs.GP{AbstractGPs.ZeroMean{Float64}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, AbstractGPs.ZeroMean{Float64}, GPDiffEq.DerivativeKernelCollection{KernelFunctions.SqExponentialKernel{Distances.Euclidean}, GPDiffEq.FirstComponentDerivativeKernel{GPDiffEq.var&quot;#d10#12&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, GPDiffEq.SecondComponentDerivativeKernel{GPDiffEq.var&quot;#d01#15&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, GPDiffEq.BothComponentDerivativeKernel{GPDiffEq.var&quot;#d11#18&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}}}(AbstractGPs.GP{AbstractGPs.ZeroMean{Float64}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}(AbstractGPs.ZeroMean{Float64}(), Squared Exponential Kernel (metric = Distances.Euclidean(0.0))), AbstractGPs.ZeroMean{Float64}(), GPDiffEq.DerivativeKernelCollection{KernelFunctions.SqExponentialKernel{Distances.Euclidean}, GPDiffEq.FirstComponentDerivativeKernel{GPDiffEq.var&quot;#d10#12&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, GPDiffEq.SecondComponentDerivativeKernel{GPDiffEq.var&quot;#d01#15&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, GPDiffEq.BothComponentDerivativeKernel{GPDiffEq.var&quot;#d11#18&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}}(GPDiffEq.FirstComponentDerivativeKernel{GPDiffEq.var&quot;#d10#12&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}(GPDiffEq.var&quot;#d10#12&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}(Squared Exponential Kernel (metric = Distances.Euclidean(0.0)))), GPDiffEq.SecondComponentDerivativeKernel{GPDiffEq.var&quot;#d01#15&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}(GPDiffEq.var&quot;#d01#15&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}(Squared Exponential Kernel (metric = Distances.Euclidean(0.0)))), GPDiffEq.BothComponentDerivativeKernel{GPDiffEq.var&quot;#d11#18&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}, KernelFunctions.SqExponentialKernel{Distances.Euclidean}}(GPDiffEq.var&quot;#d11#18&quot;{KernelFunctions.SqExponentialKernel{Distances.Euclidean}}(Squared Exponential Kernel (metric = Distances.Euclidean(0.0)))))), (α = [0.37819284925514607, 0.5311020801878809, -3.60863267159038, 5.579803225726668, -8.767769163660187, 10.398633541711558, -9.658672759336008, 8.115734064535015, -3.59242369738981, 0.7282104080886844], C = LinearAlgebra.Cholesky{Float64, Matrix{Float64}}([1.0004498987955368 0.8003773141272065 0.4109274147582345 0.13527442343644172 0.028552654979465738 0.0038641816488032754 0.0003353117715403665 1.8656075767503327e-5 6.655367228157499e-7 1.5223130876467006e-8; 0.8007374029168073 0.6002467451228027 0.7860774360298166 0.5045287013510821 0.18739357913541801 0.042437043869301076 0.005993442252878988 0.0005339982776949294 3.0207225222272073e-5 1.0889719997540142e-6; 0.4111122905071873 0.800737402916808 0.4627320221952479 0.7532454836302187 0.5447501912681774 0.21694755843305388 0.05125299553180774 0.0074308448185643515 0.0006730546137433022 3.8471936975043666e-5; 0.1353352832366127 0.4111122905071873 0.800737402916808 0.4008401941766902 0.7284671118734966 0.5632271754070077 0.23365913510519642 0.05662183999427727 0.008341514642992735 0.0007632276968352209; 0.028565500784550377 0.13533528323661262 0.41111229050718734 0.8007374029168081 0.3708790752043206 0.7123614154783097 0.5712010291281239 0.242503787177178 0.059633063470279454 0.008867504227890321; 0.0038659201394728076 0.028565500784550366 0.1353352832366127 0.41111229050718745 0.8007374029168081 0.3568392984503521 0.7029993719303738 0.5740291337269634 0.24663628796656215 0.06112098575317586; 0.00033546262790251185 0.003865920139472804 0.028565500784550366 0.1353352832366127 0.41111229050718745 0.8007374029168081 0.3509441161144569 0.6982952225737459 0.5746810106111326 0.24824985985472933; 1.866446911352057e-5 0.00033546262790251185 0.003865920139472804 0.028565500784550366 0.1353352832366127 0.41111229050718734 0.800737402916808 0.3488620260888474 0.6963366393076491 0.5746726576516153; 6.658361469857302e-7 1.8664469113520537e-5 0.00033546262790251185 0.003865920139472804 0.028565500784550366 0.13533528323661262 0.4111122905071873 0.800737402916808 0.3482835414112316 0.6956902200185071; 1.522997974471263e-8 6.658361469857302e-7 1.866446911352057e-5 0.00033546262790251185 0.0038659201394728076 0.028565500784550377 0.1353352832366127 0.4111122905071873 0.8007374029168073 0.3481716098016506], &#39;U&#39;, 0), x = [-3.0, -2.3333333333333335, -1.6666666666666667, -1.0, -0.3333333333333333, 0.3333333333333333, 1.0, 1.6666666666666667, 2.3333333333333335, 3.0], δ = [-0.13794892890990554, -0.6854582832475714, -1.0061274929761141, -0.8698642733853623, -0.35425941243021264, 0.34653271853345896, 0.8291483508130271, 1.0458078532049033, 0.6924381440180076, 0.14654808350799742]))</code></pre><p>and plot the new posterior. As we know, the derivative of <code>sin</code> is <code>cos</code>, so we can check the differentiated GP.</p><pre><code class="language-julia hljs">plot(x_plot, cos.(x_plot); label=&quot;true&quot;, linewidth=2.5)
plot!(
    x_plot,
    mean(df_post, x_plot);
    ribbons=sqrt.(var(df_post, x_plot)),
    label=&quot;GP&quot;,
    linewidth=2.5,
)</code></pre><p><img src="../derivativegp-16.svg" alt/></p><p>As we saw above, the original GP was slighly off from the true function. This is reflected and amplified in the derivative as well.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../solverapi/">« Solver API</a><a class="docs-footer-nextpage" href="../gpode/">Trajectory Uncertainty »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Tuesday 13 December 2022 15:04">Tuesday 13 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
