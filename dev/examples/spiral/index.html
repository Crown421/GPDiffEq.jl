<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Spiral ODE · GPDiffEq.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GPDiffEq.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../theory/">Theory</a></li><li><a class="tocitem" href="../../symmetries/">Symmetries</a></li><li><a class="tocitem" href="../../api/">API</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../derivativegp/">Derivative of a GP</a></li><li class="is-active"><a class="tocitem" href>Spiral ODE</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Gradient-data"><span>Gradient data</span></a></li><li><a class="tocitem" href="#Building-a-model"><span>Building a model</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Spiral ODE</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Spiral ODE</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Crown421/GPDiffEq.jl/blob/main/examples/spiral/script.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Spiral-ODE"><a class="docs-heading-anchor" href="#Spiral-ODE">Spiral ODE</a><a id="Spiral-ODE-1"></a><a class="docs-heading-anchor-permalink" href="#Spiral-ODE" title="Permalink"></a></h1><p><a href="https://nbviewer.jupyter.org/github/Crown421/GPDiffEq.jl/blob/gh-pages/dev/examples/spiral.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p><em>You are seeing the HTML output generated by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a> from the <a href="https://github.com/Crown421/GPDiffEq.jl/blob/main/examples/spiral/script.jl">Julia source file</a>. The corresponding notebook can be viewed in <a href="https://nbviewer.jupyter.org/github/Crown421/GPDiffEq.jl/blob/gh-pages/dev/examples/spiral.ipynb">nbviewer</a>.</em></p><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>Load necessary packages</p><pre><code class="language-julia hljs">using ApproximateGPs
using Plots
using LinearAlgebra
using DifferentialEquations
using InducingPoints
using GPDiffEq
using Optimization, OptimizationOptimJL</code></pre><p>First we define an ODE and generate some data points from it.</p><pre><code class="language-julia hljs">u0 = [2.0; 0.0]
datasize = 20
tspan = (0.0, 3.0)
datatspan = (0.0, 1.5)
datatsteps = range(datatspan[1], datatspan[2]; length=datasize)

function trueODEfunc(u, p, t)
    du = similar(u)
    true_A = [-0.1 2.0; -2.0 -0.1]
    return du .= ((u .^ 3)&#39;true_A)&#39;
end

prob_trueode = ODEProblem(trueODEfunc, u0, tspan)
sol = solve(prob_trueode, Tsit5())
ode_data = Array(sol(datatsteps))

traj = sol(datatsteps);

p = plot(sol)
scatter!(p, datatsteps, ode_data[1, :]; markersize=4)#, markerstyle = :star)
scatter!(p, datatsteps, ode_data[2, :]; m=(4, :pentagon), lab=&quot;pentagon&quot;)#, markerstyle = :star)</code></pre><p><img src="../spiral-6.svg" alt/></p><h2 id="Gradient-data"><a class="docs-heading-anchor" href="#Gradient-data">Gradient data</a><a id="Gradient-data-1"></a><a class="docs-heading-anchor-permalink" href="#Gradient-data" title="Permalink"></a></h2><p>For this example we get gradient observations from our trajectory data via finite differences</p><p>First, we set all necessary variables</p><pre><code class="language-julia hljs">scaker = with_lengthscale(SqExponentialKernel(), 1.0)
moker = IndependentMOKernel(scaker)
##ToDo: make ODE data into col_vecs and add number programmatically
x = MOInput(datatsteps, 2)
σ_n = 1e-6
y = ode_data&#39;[:]</code></pre><p>and build a finite GP from them</p><pre><code class="language-julia hljs">g = GP(moker)
gt = g(x, σ_n)
gt_post = posterior(gt, y)</code></pre><p>Now we use the following convenience functions to a loglikelihood loss function and a function to rebuild the gp with the optimal parameters. Note that we use optimize over the logarithm of the parameters, to ensure their positivity. For more details see <a href="https://juliagaussianprocesses.github.io/KernelFunctions.jl/dev/examples/train-kernel-parameters/">this KernelFunctions.jl example</a></p><pre><code class="language-julia hljs">loss, buildgppost = gp_negloglikelihood(gt, x, y)

p0 = log.([1.0])
unfl(x) = exp.(x)

#optp = gp_train(loss ∘ unfl, p0; show_trace=true, show_every=15)</code></pre><pre><code class="nohighlight hljs">unfl (generic function with 1 method)</code></pre><p>Optimizing:</p><pre><code class="language-julia hljs">adtype = Optimization.AutoZygote()

optf = Optimization.OptimizationFunction((x, p) -&gt; (loss ∘ unfl)(x), adtype)
optprob = Optimization.OptimizationProblem(optf, p0)

optp = Optimization.solve(optprob, NelderMead(); maxiters=300)

optparams = unfl(optp)</code></pre><pre><code class="nohighlight hljs">1-element Vector{Float64}:
 7.268328510367432</code></pre><p>Now we can build a FiniteGP with the optimized parameters,</p><pre><code class="language-julia hljs">optpost = buildgppost(optparams)</code></pre><p>which fits pretty well</p><pre><code class="language-julia hljs">t_plot = range(datatspan...; length=100)
t_plot_mo = MOInput(t_plot, 2)
opt_pred_mean = mean(optpost, t_plot_mo)
opt_pred_mean = reshape(opt_pred_mean, :, 2)
pred_mean = mean(gt_post, t_plot_mo)
pred_mean = reshape(pred_mean, :, 2)
# pred_cov = diag(cov(optpost, t_plot_mo))
# pred_cov = reshape(pred_cov, :, 2)
# plot!(t_plot, pred_mean; ribbons = pred_cov)
plot(sol(t_plot); label=[&quot;ode&quot; &quot;&quot;], color=[:skyblue :navy], linewidth=3.5)
plot!(
    t_plot,
    pred_mean;
    label=[&quot;gp&quot; &quot;&quot;],
    color=[:limegreen :darkgreen],
    linewidth=2.5,
    linestyle=:dashdot,
)
plot!(
    t_plot,
    opt_pred_mean;
    label=[&quot;opt. gp&quot; &quot;&quot;],
    color=[:tomato :firebrick],
    linewidth=2.5,
    linestyle=:dash,
)</code></pre><p><img src="../spiral-19.svg" alt/></p><p>GPs are closed under linear operators, which means that we can very easily obtain derivative information:</p><pre><code class="language-julia hljs">deriv_post = differentiate(optpost)
du_pred_mean = mean(deriv_post, x)
du_pred_mean = reshape(du_pred_mean, :, 2)
du_pred_mean = du_pred_mean ./ norm.(eachrow(du_pred_mean))

du = trueODEfunc.(eachcol(ode_data), 0, 0)
du = du ./ maximum(norm.(du))
quiver(ode_data[1, :], ode_data[2, :]; quiver=(getindex.(du, 1), getindex.(du, 2)))
quiver!(ode_data[1, :], ode_data[2, :]; quiver=(du_pred_mean[:, 1], du_pred_mean[:, 2]))</code></pre><p><img src="../spiral-21.svg" alt/></p><p>This leaves us with <code>u</code> and <code>udot</code> pairs as in the input and output:</p><pre><code class="language-julia hljs">u = ColVecs(ode_data)
udot = ColVecs(du_pred_mean&#39;)</code></pre><pre><code class="nohighlight hljs">20-element KernelFunctions.ColVecs{Float64, LinearAlgebra.Adjoint{Float64, Matrix{Float64}}, SubArray{Float64, 1, LinearAlgebra.Adjoint{Float64, Matrix{Float64}}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, false}}:
 [-0.03165347046698772, 0.9994989033547739]
 [-0.3131227464619143, 0.9497126647824319]
 [-0.9679245733258961, 0.251240960736664]
 [-0.9981774178119854, -0.06034768073585721]
 [-0.9925599672581026, -0.12175677146095097]
 [-0.6642477894990115, -0.7475124575187205]
 [-0.03420468135829994, -0.9994148486855582]
 [0.045374704086262395, -0.9989700377033758]
 [0.1533555686837154, -0.9881710730200991]
 [0.6865910743527178, -0.7270438065338158]
 [0.9917640001668678, -0.1280787569154741]
 [0.9987723387326086, 0.04953600087406405]
 [0.9983241843164803, 0.057869015965663614]
 [0.9626976689863879, 0.2705793749127511]
 [0.6273635437792426, 0.7787265142119859]
 [0.1154155588390388, 0.9933172951166572]
 [-0.03179474807481451, 0.9994944191914525]
 [-0.06279683463643287, 0.9980263310953498]
 [-0.10676913637339373, 0.9942838385079382]
 [-0.5438482382019165, 0.8391835876640293]</code></pre><h2 id="Building-a-model"><a class="docs-heading-anchor" href="#Building-a-model">Building a model</a><a id="Building-a-model-1"></a><a class="docs-heading-anchor-permalink" href="#Building-a-model" title="Permalink"></a></h2><p>Now we build a model for the the ODE.</p><pre><code class="language-julia hljs">scaker = with_lengthscale(SqExponentialKernel(), ones(2))
moker = IndependentMOKernel(scaker)

u_mo = MOInput(u, 2)
σ_n = 1e-6
y = reduce(vcat, udot.X)</code></pre><p>and build a posterior GP</p><pre><code class="language-julia hljs">gpmodel = GP(moker)
fin_gpmodel = gpmodel(u_mo, σ_n)
post_gpmodel = posterior(fin_gpmodel, y)</code></pre><pre><code class="nohighlight hljs">AbstractGPs.PosteriorGP{AbstractGPs.GP{AbstractGPs.ZeroMean{Float64}, KernelFunctions.IndependentMOKernel{KernelFunctions.TransformedKernel{KernelFunctions.SqExponentialKernel{Distances.Euclidean}, KernelFunctions.ARDTransform{Vector{Float64}}}}}, NamedTuple{(:α, :C, :x, :δ), Tuple{Vector{Float64}, LinearAlgebra.Cholesky{Float64, Matrix{Float64}}, KernelFunctions.MOInputIsotopicByOutputs{SubArray{Float64, 1, Matrix{Float64}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}, KernelFunctions.ColVecs{Float64, Matrix{Float64}, SubArray{Float64, 1, Matrix{Float64}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}}, Int64}, Vector{Float64}}}}(AbstractGPs.GP{AbstractGPs.ZeroMean{Float64}, KernelFunctions.IndependentMOKernel{KernelFunctions.TransformedKernel{KernelFunctions.SqExponentialKernel{Distances.Euclidean}, KernelFunctions.ARDTransform{Vector{Float64}}}}}(AbstractGPs.ZeroMean{Float64}(), Independent Multi-Output Kernel
	Squared Exponential Kernel (metric = Distances.Euclidean(0.0))
	- ARD Transform (dims: 2)), (α = [53.50455982211798, -379.9364005747268, 347.4231781324362, 45.82685544593709, -24.087866709024226, 16.587648456477808, 4.7214045831247775, -46.812092326089534, 154.01348555865272, -399.1773674515109, 872.2545086314801, -1664.652447181485, 2784.600839946311, -4313.540249005141, 6536.115091132402, -9476.020376201013, 12373.257942434724, -12960.850779318162, 9395.768306678747, -3323.5269120297035, -55.17034749194778, 377.5148632623454, -340.73809754964293, -33.95213545796888, 5.498410781219144, 18.21492395088697, -63.21947643515656, 141.87295895553962, -304.0784204407977, 625.423743817468, -1174.580243349298, 2032.6969167225907, -3176.452159677253, 4667.008699757055, -6799.862670339678, 9608.950955585782, -12353.097116901768, 12817.354904150321, -9226.973513540877, 3241.7859142548273], C = LinearAlgebra.Cholesky{Float64, Matrix{Float64}}([1.000000499999875 0.4954890097390399 0.13993834623708593 0.03530424134314175 0.00444576739272158 0.0007560986595125537 0.0007509268990312181 0.001093377520541939 0.0010029710830390041 0.0012604227250751637 0.004673259185560229 0.022892467481398317 0.07722260972802414 0.18355091218552266 0.36409817560599433 0.6199106031869643 0.8186728373742853 0.8396223009285089 0.6945431160676236 0.47629343845451166 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.4954892574834829 0.8686147829894594 0.6717575882034632 0.20411670261425433 0.027115051171701512 0.0034162079323442635 0.0012651869851848753 0.00034639899320036666 -0.00020036865567015383 -0.0004882452235482161 -0.0020584192224736234 -0.01033045972290571 -0.03521109035917444 -0.08334689542730384 -0.15419934127445 -0.20642957902388837 -0.1221812245170763 0.14012518189977033 0.47467588100184205 0.6824889460247667 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.13993841620624156 0.6528364843004064 0.7274338471252871 0.6275165461963711 0.17190998412922162 0.03093624738966359 0.009771438084674415 0.0032465327822652273 0.0008644072809057171 0.0005292673332924166 0.0015142617286606863 0.00664911106331592 0.021016811067991435 0.047559406169392575 0.08560574464996032 0.11440624409550348 0.09217133133930441 0.04646716595292083 0.07408690215492825 0.2504943954020989 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.03530425899525801 0.1947916489285059 0.5985341363433084 0.750542448171219 0.690521003904372 0.27453815683958377 0.11109297507710977 0.03596437202185668 0.007563255149946895 0.0019857610302539946 0.001265963312525278 -0.00038304006988596823 -0.007454286470852762 -0.021500316813582665 -0.04034587794177437 -0.05066883944304677 -0.024693584099596315 0.031278779144743606 0.07345210410367065 0.0868603690059326 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.0044457696156047204 0.02575536317220532 0.14389001583017466 0.6318332735628499 0.7020496490105488 0.7645947470968396 0.4245000116879691 0.1426506749886009 0.030217985286780522 0.0068406292231288504 0.003527470057632727 0.003413870035749387 0.006070060886774809 0.013361084643559914 0.024218515826061018 0.030207467794653938 0.014614962367151735 -0.01889180342749871 -0.044434129137333245 -0.05020136099234295 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.000756099037561789 0.0033420072878669726 0.024904744251719995 0.22618954605318292 0.7317720793950104 0.582284620771208 0.6866042591025339 0.33831432540573736 0.09519854226938353 0.022831369315706316 0.008433499200752393 0.002949559584746449 -0.0021480468921444198 -0.0083793737840418 -0.015964153380994977 -0.019738987182315426 -0.008291566843657555 0.015733920651725165 0.03424569110433607 0.03895578330148332 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.0007509272744945739 0.0014710361441648348 0.008063057224070832 0.08979648926734561 0.37644956870970486 0.7551760218686556 0.579599893681955 0.7509690001498738 0.4019963703804609 0.14964191794166706 0.06732159282466474 0.032557982130976916 0.013617744728781416 0.008177206948236062 0.009953613126145712 0.012122844601921076 0.007870908413687368 -0.0027747739356427134 -0.011808040176421276 -0.013942055754670455 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.0010933780672305626 0.0008426438312307558 0.002747339425887387 0.029139347547010506 0.12555437550781734 0.3160412234568 0.7321331942690971 0.5476636481160297 0.773344656136816 0.5228258849523095 0.30015314747570176 0.14822385988239575 0.053864978702514006 0.014178321608387015 0.001915663679666482 -0.00089960452669142 0.0024840535008976514 0.008629177703020643 0.012390363003917826 0.012348067986445884 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.0010029715845244203 0.00032291797236906817 0.0006345540636318991 0.006213484451678832 0.026584738715043233 0.08064037739158374 0.31203748389523345 0.7622130558318682 0.47989902668535933 0.7468919646687946 0.5844828076198828 0.3076502633023704 0.11712490041254722 0.03729012800968886 0.015936314608858443 0.010587255311379475 0.004540911141704422 -0.003378040870381009 -0.008340303004659873 -0.009093419584040648 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.0012604233552863688 0.00020042858900210121 0.00023340601029869334 0.0017673612171146685 0.006257022136131831 0.01908549016957994 0.10553850689527879 0.407483516586202 0.8253099003974074 0.3818896011665409 0.6384255680668792 0.4978642512313008 0.24931184274521043 0.09137451585300457 0.03187972671296527 0.013900201357947168 0.008564348789880993 0.0081263055642414 0.008576714724509842 0.00813087522130185 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.004673261522189239 0.0005275751998768523 0.00037273466439827105 0.0016452116197411277 0.003575912163823596 0.007998684227319384 0.04646381673101477 0.2183506088477983 0.5406030322752023 0.8475824543762518 0.39503923069571484 0.7062601948609506 0.5805838568716439 0.3108592477207441 0.14745942962691244 0.08013178552578927 0.04253347323784412 0.0162585729729282 0.002658273102034897 -0.0011585015441411934 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.022892478927629197 0.002369776012448131 0.0011007577728922007 0.0025845211997026314 0.0030969212655942487 0.004410267676370807 0.022371509947614165 0.10714098666486373 0.2757692174546693 0.5024053515494593 0.8235225022755663 0.36736114366996875 0.6945261454289435 0.6331662279771186 0.41456425715937123 0.2505504532849685 0.1333322123832745 0.056190000709552594 0.02069962075466178 0.011351724060205676 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.07722264833931936 0.0076780808124464845 0.0024414268892526884 0.0031327522676623857 0.0021157056383434383 0.0019321567023818755 0.008385411698039644 0.03973795754626482 0.10336383282988214 0.21299236381298908 0.47452150176198155 0.8360581365295573 0.30635505138239916 0.627883645958683 0.6260839649274255 0.4322972488374584 0.21294285861206425 0.06541212290282548 0.007832072511157431 0.0010158152584574017 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.1835510039609558 0.018551114231069425 0.004293223441854103 0.0031750461156396376 0.0012657305195947024 0.0007593391266956595 0.002766548679191313 0.01252986275541879 0.031832768466182736 0.07153772912287462 0.20878964043172557 0.5168887098786058 0.8589770428863565 0.23369189141742688 0.46416002703673326 0.3977958878010106 0.17704189661746367 0.02013861226885181 -0.023997278471858514 -0.011008422711275343 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.3640983576550366 0.046466817120581226 0.009639235131901278 0.004817275991235866 0.0012969793671893117 0.0005420236436424839 0.001521485391672366 0.005749470061052732 0.012507605828791174 0.026868859928768796 0.09121296130185183 0.28837043298022 0.6112228781738439 0.89860009840827 0.17734729139958555 0.3400667320390011 0.2641692805887422 0.0963016840019637 0.008204113055604794 0.006316655894332515 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.6199109131421885 0.12785110691339965 0.0313016027634215 0.013512444910211011 0.003045449638059449 0.000995039824148341 0.0019898941479791986 0.005397773280789716 0.008670921362068158 0.015157670386368121 0.05063472648874113 0.17622413609964763 0.4159432932340139 0.6877850537918145 0.9024459201416005 0.16038348230900862 0.3331019127634759 0.32233715134595203 0.21134352224057554 0.12932638166756244 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.8186732467106017 0.29951497567154806 0.09953610441685301 0.043268847198067645 0.009380841676123798 0.0026201766104041613 0.0036905483603607734 0.006814855455023468 0.007655070755526318 0.010140694767973905 0.030366960655628043 0.10595750831473474 0.25519104275719634 0.4394023031189203 0.650611366658185 0.8879425239532279 0.16816779401419935 0.369398487095057 0.39555437328914306 0.295812020477011 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.8396227207395545 0.5377384269091086 0.24542729978941608 0.110879085397081 0.023856106697302353 0.005855318526244986 0.005911830672264455 0.007512542172206589 0.005954511097352038 0.005983219425981332 0.01585103047646528 0.05437242366700922 0.13106040359884066 0.2307130303037917 0.379370764743143 0.6305669564270212 0.8940230413025004 0.11731255865901072 0.2652984102902564 0.3076318810317202 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.6945434633390949 0.7564489681681593 0.46995366030916136 0.22302927242942652 0.048220172014827936 0.01057074816652166 0.00781306340221759 0.006971538081022406 0.00397123319735068 0.0030637260089022467 0.007180966413035531 0.024047893475625633 0.05757403523141519 0.10277901181800257 0.18568307383293076 0.3711052091886543 0.6540400265326823 0.9044131811185793 0.07192846736055095 0.17622816482927312 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.4762936766011714 0.828818151909036 0.7073369461886921 0.3785043435816474 0.08842076141261883 0.018587147771367517 0.010674319341562221 0.007004876721805198 0.002986718635318442 0.0018010448066119336 0.0036477879415751165 0.01140773409765339 0.025938138188051386 0.04494698968018632 0.08546074908935598 0.1978829483969842 0.4206024784360143 0.6998208525062006 0.9229216758526686 0.0480907525215469 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 1.000000499999875 0.4954890097390399 0.13993834623708593 0.03530424134314175 0.00444576739272158 0.0007560986595125537 0.0007509268990312181 0.001093377520541939 0.0010029710830390041 0.0012604227250751637 0.004673259185560229 0.022892467481398317 0.07722260972802414 0.18355091218552266 0.36409817560599433 0.6199106031869643 0.8186728373742853 0.8396223009285089 0.6945431160676236 0.47629343845451166; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.4954892574834829 0.8686147829894594 0.6717575882034632 0.20411670261425433 0.027115051171701512 0.0034162079323442635 0.0012651869851848753 0.00034639899320036666 -0.00020036865567015383 -0.0004882452235482161 -0.0020584192224736234 -0.01033045972290571 -0.03521109035917444 -0.08334689542730384 -0.15419934127445 -0.20642957902388837 -0.1221812245170763 0.14012518189977033 0.47467588100184205 0.6824889460247667; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.13993841620624156 0.6528364843004064 0.7274338471252871 0.6275165461963711 0.17190998412922162 0.03093624738966359 0.009771438084674415 0.0032465327822652273 0.0008644072809057171 0.0005292673332924166 0.0015142617286606863 0.00664911106331592 0.021016811067991435 0.047559406169392575 0.08560574464996032 0.11440624409550348 0.09217133133930441 0.04646716595292083 0.07408690215492825 0.2504943954020989; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.03530425899525801 0.1947916489285059 0.5985341363433084 0.750542448171219 0.690521003904372 0.27453815683958377 0.11109297507710977 0.03596437202185668 0.007563255149946895 0.0019857610302539946 0.001265963312525278 -0.00038304006988596823 -0.007454286470852762 -0.021500316813582665 -0.04034587794177437 -0.05066883944304677 -0.024693584099596315 0.031278779144743606 0.07345210410367065 0.0868603690059326; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0044457696156047204 0.02575536317220532 0.14389001583017466 0.6318332735628499 0.7020496490105488 0.7645947470968396 0.4245000116879691 0.1426506749886009 0.030217985286780522 0.0068406292231288504 0.003527470057632727 0.003413870035749387 0.006070060886774809 0.013361084643559914 0.024218515826061018 0.030207467794653938 0.014614962367151735 -0.01889180342749871 -0.044434129137333245 -0.05020136099234295; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.000756099037561789 0.0033420072878669726 0.024904744251719995 0.22618954605318292 0.7317720793950104 0.582284620771208 0.6866042591025339 0.33831432540573736 0.09519854226938353 0.022831369315706316 0.008433499200752393 0.002949559584746449 -0.0021480468921444198 -0.0083793737840418 -0.015964153380994977 -0.019738987182315426 -0.008291566843657555 0.015733920651725165 0.03424569110433607 0.03895578330148332; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0007509272744945739 0.0014710361441648348 0.008063057224070832 0.08979648926734561 0.37644956870970486 0.7551760218686556 0.579599893681955 0.7509690001498738 0.4019963703804609 0.14964191794166706 0.06732159282466474 0.032557982130976916 0.013617744728781416 0.008177206948236062 0.009953613126145712 0.012122844601921076 0.007870908413687368 -0.0027747739356427134 -0.011808040176421276 -0.013942055754670455; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0010933780672305626 0.0008426438312307558 0.002747339425887387 0.029139347547010506 0.12555437550781734 0.3160412234568 0.7321331942690971 0.5476636481160297 0.773344656136816 0.5228258849523095 0.30015314747570176 0.14822385988239575 0.053864978702514006 0.014178321608387015 0.001915663679666482 -0.00089960452669142 0.0024840535008976514 0.008629177703020643 0.012390363003917826 0.012348067986445884; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0010029715845244203 0.00032291797236906817 0.0006345540636318991 0.006213484451678832 0.026584738715043233 0.08064037739158374 0.31203748389523345 0.7622130558318682 0.47989902668535933 0.7468919646687946 0.5844828076198828 0.3076502633023704 0.11712490041254722 0.03729012800968886 0.015936314608858443 0.010587255311379475 0.004540911141704422 -0.003378040870381009 -0.008340303004659873 -0.009093419584040648; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0012604233552863688 0.00020042858900210121 0.00023340601029869334 0.0017673612171146685 0.006257022136131831 0.01908549016957994 0.10553850689527879 0.407483516586202 0.8253099003974074 0.3818896011665409 0.6384255680668792 0.4978642512313008 0.24931184274521043 0.09137451585300457 0.03187972671296527 0.013900201357947168 0.008564348789880993 0.0081263055642414 0.008576714724509842 0.00813087522130185; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.004673261522189239 0.0005275751998768523 0.00037273466439827105 0.0016452116197411277 0.003575912163823596 0.007998684227319384 0.04646381673101477 0.2183506088477983 0.5406030322752023 0.8475824543762518 0.39503923069571484 0.7062601948609506 0.5805838568716439 0.3108592477207441 0.14745942962691244 0.08013178552578927 0.04253347323784412 0.0162585729729282 0.002658273102034897 -0.0011585015441411934; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.022892478927629197 0.002369776012448131 0.0011007577728922007 0.0025845211997026314 0.0030969212655942487 0.004410267676370807 0.022371509947614165 0.10714098666486373 0.2757692174546693 0.5024053515494593 0.8235225022755663 0.36736114366996875 0.6945261454289435 0.6331662279771186 0.41456425715937123 0.2505504532849685 0.1333322123832745 0.056190000709552594 0.02069962075466178 0.011351724060205676; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.07722264833931936 0.0076780808124464845 0.0024414268892526884 0.0031327522676623857 0.0021157056383434383 0.0019321567023818755 0.008385411698039644 0.03973795754626482 0.10336383282988214 0.21299236381298908 0.47452150176198155 0.8360581365295573 0.30635505138239916 0.627883645958683 0.6260839649274255 0.4322972488374584 0.21294285861206425 0.06541212290282548 0.007832072511157431 0.0010158152584574017; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.1835510039609558 0.018551114231069425 0.004293223441854103 0.0031750461156396376 0.0012657305195947024 0.0007593391266956595 0.002766548679191313 0.01252986275541879 0.031832768466182736 0.07153772912287462 0.20878964043172557 0.5168887098786058 0.8589770428863565 0.23369189141742688 0.46416002703673326 0.3977958878010106 0.17704189661746367 0.02013861226885181 -0.023997278471858514 -0.011008422711275343; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.3640983576550366 0.046466817120581226 0.009639235131901278 0.004817275991235866 0.0012969793671893117 0.0005420236436424839 0.001521485391672366 0.005749470061052732 0.012507605828791174 0.026868859928768796 0.09121296130185183 0.28837043298022 0.6112228781738439 0.89860009840827 0.17734729139958555 0.3400667320390011 0.2641692805887422 0.0963016840019637 0.008204113055604794 0.006316655894332515; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.6199109131421885 0.12785110691339965 0.0313016027634215 0.013512444910211011 0.003045449638059449 0.000995039824148341 0.0019898941479791986 0.005397773280789716 0.008670921362068158 0.015157670386368121 0.05063472648874113 0.17622413609964763 0.4159432932340139 0.6877850537918145 0.9024459201416005 0.16038348230900862 0.3331019127634759 0.32233715134595203 0.21134352224057554 0.12932638166756244; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.8186732467106017 0.29951497567154806 0.09953610441685301 0.043268847198067645 0.009380841676123798 0.0026201766104041613 0.0036905483603607734 0.006814855455023468 0.007655070755526318 0.010140694767973905 0.030366960655628043 0.10595750831473474 0.25519104275719634 0.4394023031189203 0.650611366658185 0.8879425239532279 0.16816779401419935 0.369398487095057 0.39555437328914306 0.295812020477011; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.8396227207395545 0.5377384269091086 0.24542729978941608 0.110879085397081 0.023856106697302353 0.005855318526244986 0.005911830672264455 0.007512542172206589 0.005954511097352038 0.005983219425981332 0.01585103047646528 0.05437242366700922 0.13106040359884066 0.2307130303037917 0.379370764743143 0.6305669564270212 0.8940230413025004 0.11731255865901072 0.2652984102902564 0.3076318810317202; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.6945434633390949 0.7564489681681593 0.46995366030916136 0.22302927242942652 0.048220172014827936 0.01057074816652166 0.00781306340221759 0.006971538081022406 0.00397123319735068 0.0030637260089022467 0.007180966413035531 0.024047893475625633 0.05757403523141519 0.10277901181800257 0.18568307383293076 0.3711052091886543 0.6540400265326823 0.9044131811185793 0.07192846736055095 0.17622816482927312; 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.4762936766011714 0.828818151909036 0.7073369461886921 0.3785043435816474 0.08842076141261883 0.018587147771367517 0.010674319341562221 0.007004876721805198 0.002986718635318442 0.0018010448066119336 0.0036477879415751165 0.01140773409765339 0.025938138188051386 0.04494698968018632 0.08546074908935598 0.1978829483969842 0.4206024784360143 0.6998208525062006 0.9229216758526686 0.0480907525215469], &#39;U&#39;, 0), x = Tuple{SubArray{Float64, 1, Matrix{Float64}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}, Int64}[([2.0, 0.0], 1), ([1.8722493084803944, 1.1781761209680564], 1), ([1.2054087302920322, 1.8170664239060492], 1), ([0.1927492468605379, 1.8496886378714485], 1), ([-0.7634822105326886, 1.7873921333439653], 1), ([-1.491074439188309, 1.478876477818158], 1), ([-1.715496730290473, 0.763863564666627], 1), ([-1.6927384267129184, -0.02548281303906763], 1), ([-1.6375083040399991, -0.7603351496646811], 1), ([-1.4020967698225453, -1.3335489511640215], 1), ([-0.8766694239883193, -1.5673446110271225], 1), ([-0.25353811206310417, -1.5733593627742373], 1), ([0.3441060668872955, -1.542770322404427], 1), ([0.8906186118860617, -1.4696252360523447], 1), ([1.2853939931883984, -1.228820867354409], 1), ([1.4436651991698213, -0.804270221306424], 1), ([1.4524849481444388, -0.3168086958982196], 1), ([1.4296700708970633, 0.1559776650721993], 1), ([1.3954544084611666, 0.6029309254295775], 1), ([1.2893454342143849, 0.9891467953863277], 1), ([2.0, 0.0], 2), ([1.8722493084803944, 1.1781761209680564], 2), ([1.2054087302920322, 1.8170664239060492], 2), ([0.1927492468605379, 1.8496886378714485], 2), ([-0.7634822105326886, 1.7873921333439653], 2), ([-1.491074439188309, 1.478876477818158], 2), ([-1.715496730290473, 0.763863564666627], 2), ([-1.6927384267129184, -0.02548281303906763], 2), ([-1.6375083040399991, -0.7603351496646811], 2), ([-1.4020967698225453, -1.3335489511640215], 2), ([-0.8766694239883193, -1.5673446110271225], 2), ([-0.25353811206310417, -1.5733593627742373], 2), ([0.3441060668872955, -1.542770322404427], 2), ([0.8906186118860617, -1.4696252360523447], 2), ([1.2853939931883984, -1.228820867354409], 2), ([1.4436651991698213, -0.804270221306424], 2), ([1.4524849481444388, -0.3168086958982196], 2), ([1.4296700708970633, 0.1559776650721993], 2), ([1.3954544084611666, 0.6029309254295775], 2), ([1.2893454342143849, 0.9891467953863277], 2)], δ = [-0.03165347046698772, 0.9994989033547739, -0.3131227464619143, 0.9497126647824319, -0.9679245733258961, 0.251240960736664, -0.9981774178119854, -0.06034768073585721, -0.9925599672581026, -0.12175677146095097, -0.6642477894990115, -0.7475124575187205, -0.03420468135829994, -0.9994148486855582, 0.045374704086262395, -0.9989700377033758, 0.1533555686837154, -0.9881710730200991, 0.6865910743527178, -0.7270438065338158, 0.9917640001668678, -0.1280787569154741, 0.9987723387326086, 0.04953600087406405, 0.9983241843164803, 0.057869015965663614, 0.9626976689863879, 0.2705793749127511, 0.6273635437792426, 0.7787265142119859, 0.1154155588390388, 0.9933172951166572, -0.03179474807481451, 0.9994944191914525, -0.06279683463643287, 0.9980263310953498, -0.10676913637339373, 0.9942838385079382, -0.5438482382019165, 0.8391835876640293]))</code></pre><p>and optimize</p><pre><code class="language-julia hljs">loss, buildgppost = gp_negloglikelihood(fin_gpmodel, u_mo, y)

p0 = log.(ones(2))
unfl(x) = exp.(x)

optf = Optimization.OptimizationFunction((x, p) -&gt; (loss ∘ unfl)(x), adtype)
optprob = Optimization.OptimizationProblem(optf, p0)

optp = Optimization.solve(optprob, NelderMead(); maxiters=300)

optparams = unfl(optp)</code></pre><pre><code class="nohighlight hljs">2-element Vector{Float64}:
  0.6525913342039246
 42.572978622897175</code></pre><p>We build a posterior GP with the optimized parameters,</p><pre><code class="language-julia hljs">optpost = buildgppost(optparams)</code></pre><p>and incorporate into a GP ode model. Unfortunately, this does not currently match the previous implementation.</p><pre><code class="language-julia hljs">gpode = GPODE(optpost, tspan)
gpsol = gpode(u0)

plot(gpsol)</code></pre><p><img src="../spiral-33.svg" alt/></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../derivativegp/">« Derivative of a GP</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Tuesday 15 November 2022 00:26">Tuesday 15 November 2022</span>. Using Julia version 1.8.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
